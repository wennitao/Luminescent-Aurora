####莫比乌斯反演

莫比乌斯反演基本形式：

对于一个函数$f(x)$

设$g(x)=\sum _{x \mid d} f(d)$，那么

$f(x)=\sum _{x \mid d} \mu(\frac {d} {x}) \cdot g(d)$



$1$：$f(x)=1$

$e$：$f(x) = [x = 1]$

$id$：$f(x) = x$



推式子：

1. 1到$n$与$n$互质的数的个数：$\sum _{i=1} ^{n} [gcd (i, n) = 1]$

   令$f(x)=\sum _{i=1} ^{n} [gcd (i, n) = x]$

   $g(x) = \sum _{x \mid d} f(d) = \sum_{x \mid d} \sum _{i=1} ^{n} [gcd (i, n) = d] = \sum _{i=1} ^{n} [x \mid gcd (i, n)] = \begin {cases} \lfloor \frac {n} {x} \rfloor, & x \mid n \\ 0, & x \not\mid n \end {cases}$

   

   由莫比乌斯反演得：

   $f(x) = \sum _{x \mid d} \mu(\frac {d} {x}) \cdot g(d) = \begin {cases} \sum_{x \mid d} \mu(\frac {d} {x}) \cdot \lfloor \frac {n} {d} \rfloor, & d \mid n \\ 0, & d \not\mid n \end {cases} = \sum_ {d \mid n} \sum _{x \mid d} \mu (\frac {d} {x}) \cdot \lfloor \frac {n} {d} \rfloor$

   

   所求式子即为$f(1) = \sum _{d \mid n} \mu (d) \cdot \lfloor \frac {n} {d} \rfloor$

   根据欧拉函数定义，所求即为$\varphi(n)$。

   因此$\varphi (n) = \sum _{d \mid n} \mu (d) \cdot \frac {n} {d} = \sum _{d \mid n} \mu (\frac n d) \cdot d$

   

2. 1D gcd sum：$\sum _{i=1} ^{n} gcd (i, n)=\sum _{d \mid n} \varphi(d) \lfloor \frac {n}{d} \rfloor$

   $\sum_{i=1} ^{n} gcd(i, n) = \sum _{d=1} ^{n} d \sum _{i=1} ^{n} [gcd (i,n) = d]$

   

   设$f(x) = \sum _{i = 1} ^{n} [gcd(i, n) = x]$

   $g(x) = \sum _{x \mid d} f(d)  = \sum _{x \mid d} \sum _{i=1} ^{n} [gcd (i, n) = d] = \sum _{i=1} ^{n} [x \mid gcd (i, n)] = \begin {cases} \lfloor \frac {n} {x} \rfloor, & x \mid n \\ 0, & x \not\mid n \end {cases}$

   

   由莫比乌斯反演得：

   $f(x) = \sum _{x \mid d} \mu(\frac {d} {x}) \cdot g(d) = \begin {cases} \sum_{x \mid d} \mu(\frac {d} {x}) \cdot \lfloor \frac {n} {d} \rfloor, & d \mid n \\ 0, & d \not\mid n \end {cases} = \sum_ {d \mid n} \sum _{x \mid d} \mu (\frac {d} {x}) \cdot \lfloor \frac {n} {d} \rfloor$ 

   

   代回得：$\sum_{i=1} ^{n} gcd(i, n) = \begin {cases} \sum _{d=1} ^{n} d \sum _{d \mid x} \mu(\frac {x} {d}) \cdot \lfloor \frac {n} {x} \rfloor, & x \mid n \\ 0, & x \not\mid n \end {cases} = \sum_{x \mid n} \sum _{d \mid x} d \cdot \mu(\frac {x} {d}) \cdot \lfloor {\frac {n} {x}} \rfloor= \sum _{x \mid n} \varphi (x) \cdot \lfloor {\frac {n} {x}} \rfloor $

   (参考$\varphi (n) = \sum _{d \mid n} \mu (\frac n d) \cdot d$)

   即$\sum _{i=1} ^{n} gcd (i, n)=\sum _{d \mid n} \varphi(d) \lfloor \frac {n}{d} \rfloor$

   

3. 2D gcd sum：$\sum _{i=1} ^{n} \sum _{j=1} ^{m} gcd (i, j)$

   $\sum _{i=1} ^{n} \sum _{j=1} ^{m} gcd (i, j) = \sum _{d=1} ^{n}d \sum _{i=1} ^{n} \sum _{j=1} ^{m} [gcd (i, j) = d]$

   

   设$f(x) = \sum _{i=1} ^{n} \sum _{j=1} ^{m} [gcd (i, j) = x]$

   $g(x)=\sum _{x \mid d} f(d) = \sum _{x \mid d} \sum _{i=1} ^{n} \sum _{j=1} ^{m} [gcd (i, j) = d] = \sum _{i=1} ^{n} \sum _{j=1} ^{m} [x \mid gcd (i, j)] = \lfloor \frac {n} {x} \rfloor \lfloor \frac {m} {x} \rfloor$

   

   由莫比乌斯反演得：

   $f(x)=\sum _{x \mid d} \mu (\frac {d} {x}) \cdot g(d) = \sum _{x \mid d} \mu (\frac {d} {x}) \cdot \lfloor \frac {n} {d} \rfloor \lfloor \frac {m} {d} \rfloor$

   

   代回得$\sum _{d=1} ^{n}d \cdot f(d) = \sum _{d=1} ^n d \sum _{d \mid x} \mu (\frac {x} {d}) \cdot \lfloor \frac {n} {x} \rfloor \lfloor \frac {m} {x} \rfloor = \sum _{x=1} ^n \sum _{d \mid x} d \cdot \mu (\frac x d) \cdot \lfloor \frac {n} {x} \rfloor \lfloor \frac {m} {x} \rfloor = \sum _{x=1} ^n \varphi (x) \cdot \lfloor \frac {n} {x} \rfloor \lfloor \frac {m} {x} \rfloor$



4. 1…n和1..m中互质的数的对数

   $\sum _{i=1} ^{n} \sum _{j=1} ^{m} [gcd (i, j)=1]$

   

   设$f(x) = \sum _{i=1} ^{n} \sum _{j=1} ^{m} [gcd (i, j) = x]$

   由莫比乌斯反演得：

   $f(x)=\sum _{x \mid d} \mu (\frac {d} {x}) \cdot g(d) = \sum _{x \mid d} \mu (\frac {d} {x}) \cdot \lfloor \frac {n} {d} \rfloor \lfloor \frac {m} {d} \rfloor$

   

   所求即$\sum _{i=1} ^{n} \sum _{j=1} ^{m} [gcd (i, j)=1] = f(1) = \sum _{d=1} ^n \mu (d) \cdot \lfloor \frac {n} {d} \rfloor \lfloor \frac {m} {d} \rfloor$

---

####杜教筛

求积性函数$f(i)$的前缀和$S(i)$

$S(n) = \sum _{i=1} ^n f(i)$



杜教筛：

找一个积性函数$g(i)$，做$g$和$f$的狄利克雷卷积

$(g * f) (i) = \sum _{d \mid i} g(d) f(\frac i d)$

再做一下卷积的前缀和

$\sum _{i=1} ^n (g*f)(i) = \sum _{i=1} ^n \sum _{d \mid i} g(d) f(\frac i d)$

把$d$提出：$\sum _{d=1} ^n g(d) \sum_{d \mid i} f(\frac i d) = \sum _{d=1} ^n g(d) \sum _{i=1} ^{\frac n d} f(i) = \sum _{d=1} ^n g(d) S(\frac n d)$



$g(1)S(n) = \sum _{i=1} ^n g(i)S(\frac n i) - \sum _{i=2} ^n g(i)S(\frac n i) = \sum _{i=1} ^n (g*f)(i) - \sum _{i=2} ^n g(i)S(\frac n i)$

前半部分是狄利克雷卷积的前缀和。

如果狄利克雷卷积的前缀和非常好算，那么可以对后半部分进行数论分块，递归计算(记忆化)。



栗子：$\sum _{i=1} ^n \mu (i)$

$g(1)S(n) = \sum _{i=1} ^n (g*f)(i) - \sum _{i=2} ^n g(i)S(\frac n i)$

看到$\mu$想到$(\mu * 1) = e$即$\sum _{d \mid n} \mu (d) = [n = 1]$

$e$的前缀和就是1，十分好计算

因此取$g(x)=1$

$S(n) = 1 - \sum _{i=2} ^n S(\frac n i)$

先筛出一部分$\mu$的前缀和，然后记忆化递归计算。



栗子2：$\sum _{i=1} ^n \varphi (i)$

看到$\varphi$想到$(\varphi * 1) = id$即$\sum _{d \mid n} \varphi (d) = n$

取$g(x) = 1$

$S(n) = \frac {n(n+1)} {2} - \sum _{i=2} ^n S(\frac n i)$